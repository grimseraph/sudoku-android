name: Build Android APK
    2
    3 on:
    4   push:
    5     branches: [ main, master ]
    6   pull_request:
    7     branches: [ main, master ]
    8
    9 jobs:
   10   build:
   11     runs-on: ubuntu-latest
   12
   13     steps:
   14       - name: Checkout Source
   15         uses: actions/checkout@v4
   16
   17       - name: Setup Java
   18         uses: actions/setup-java@v4
   19         with:
   20           distribution: 'zulu'
   21           java-version: '17'
   22
   23       - name: Setup Node.js
   24         uses: actions/setup-node@v4
   25         with:
   26           node-version: '20'
   27
   28       - name: Install Dependencies
   29         run: npm install
   30
   31       - name: Prepare Android Platform
   32         run: |
   33           # 如果 android 目录没上传，则自动创建
   34           if [ ! -d "android" ]; then
   35             npx cap add android
   36           fi
   37           # 同步 Web 代码到 Android 工程
   38           npx cap sync
   39
   40       - name: Build Android App
   41         run: |
   42           cd android
   43           # 关键：修复 Windows 上传可能导致的换行符 (CRLF -> LF)
   44           # 这能彻底解决 Exit Code 127 报错
   45           sed -i 's/\r$//' gradlew
   46           # 赋予执行权限
   47           chmod +x gradlew
   48           # 开始打包
   49           ./gradlew assembleDebug
   50
   51       - name: Upload APK
   52         uses: actions/upload-artifact@v4
   53         with:
   54           name: sudoku-app-debug
   55           path: android/app/build/outputs/apk/debug/app-debug.apk