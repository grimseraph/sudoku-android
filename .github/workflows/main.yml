│  1 - name: Build Android APK                                                                                     │
│  2 -     2                                                                                                       │
│  3 -     3 on:                                                                                                   │
│  4 -     4   push:                                                                                               │
│  5 -     5     branches: [ main, master ]                                                                        │
│  6 -     6   pull_request:                                                                                       │
│  7 -     7     branches: [ main, master ]                                                                        │
│  8 -     8                                                                                                       │
│  9 -     9 jobs:                                                                                                 │
│ 10 -    10   build:                                                                                              │
│ 11 -    11     runs-on: ubuntu-latest                                                                            │
│ 12 -    12                                                                                                       │
│ 13 -    13     steps:                                                                                            │
│ 14 -    14       - name: Checkout Source                                                                         │
│ 15 -    15         uses: actions/checkout@v4                                                                     │
│ 16 -    16                                                                                                       │
│ 17 -    17       - name: Setup Java                                                                              │
│ 18 -    18         uses: actions/setup-java@v4                                                                   │
│ 19 -    19         with:                                                                                         │
│ 20 -    20           distribution: 'zulu'                                                                        │
│ 21 -    21           java-version: '17'                                                                          │
│ 22 -    22                                                                                                       │
│ 23 -    23       - name: Setup Node.js                                                                           │
│ 24 -    24         uses: actions/setup-node@v4                                                                   │
│ 25 -    25         with:                                                                                         │
│ 26 -    26           node-version: '20'                                                                          │
│ 27 -    27                                                                                                       │
│ 28 -    28       - name: Install Dependencies                                                                    │
│ 29 -    29         run: npm install                                                                              │
│ 30 -    30                                                                                                       │
│ 31 -    31       - name: Prepare Android Platform                                                                │
│ 32 -    32         run: |                                                                                        │
│ 33 -    33           # 如果 android 目录没上传，则自动创建                                                       │
│ 34 -    34           if [ ! -d "android" ]; then                                                                 │
│ 35 -    35             npx cap add android                                                                       │
│ 36 -    36           fi                                                                                          │
│ 37 -    37           # 同步 Web 代码到 Android 工程                                                              │
│ 38 -    38           npx cap sync                                                                                │
│ 39 -    39                                                                                                       │
│ 40 -    40       - name: Build Android App                                                                       │
│ 41 -    41         run: |                                                                                        │
│ 42 -    42           cd android                                                                                  │
│ 43 -    43           # 关键：修复 Windows 上传可能导致的换行符 (CRLF -> LF)                                      │
│ 44 -    44           # 这能彻底解决 Exit Code 127 报错                                                           │
│ 45 -    45           sed -i 's/\r$//' gradlew                                                                    │
│ 46 -    46           # 赋予执行权限                                                                              │
│ 47 -    47           chmod +x gradlew                                                                            │
│ 48 -    48           # 开始打包                                                                                  │
│ 49 -    49           ./gradlew assembleDebug                                                                     │
│ 50 -    50                                                                                                       │
│ 51 -    51       - name: Upload APK                                                                              │
│ 52 -    52         uses: actions/upload-artifact@v4                                                              │
│ 53 -    53         with:                                                                                         │
│ 54 -    54           name: sudoku-app-debug                                                                      │
│ 55 -    55           path: android/app/build/outputs/apk/debug/app-debug.apk                                     │
│  1 + name: Build Android APK                                                                                     │
│  2 + on:                                                                                                         │
│  3 +   push:                                                                                                     │
│  4 +     branches: [main, master]                                                                                │
│  5 +   pull_request:                                                                                             │
│  6 +     branches: [main, master]                                                                                │
│  7 +                                                                                                             │
│  8 + jobs:                                                                                                       │
│  9 +   build:                                                                                                    │
│ 10 +     runs-on: ubuntu-latest                                                                                  │
│ 11 +     steps:                                                                                                  │
│ 12 +       - name: Checkout Source                                                                               │
│ 13 +         uses: actions/checkout@v4                                                                           │
│ 14 +                                                                                                             │
│ 15 +       - name: Setup Java                                                                                    │
│ 16 +         uses: actions/setup-java@v4                                                                         │
│ 17 +         with:                                                                                               │
│ 18 +           distribution: 'zulu'                                                                              │
│ 19 +           java-version: '17'                                                                                │
│ 20 +                                                                                                             │
│ 21 +       - name: Setup Node.js                                                                                 │
│ 22 +         uses: actions/setup-node@v4                                                                         │
│ 23 +         with:                                                                                               │
│ 24 +           node-version: '20'                                                                                │
│ 25 +                                                                                                             │
│ 26 +       - name: Install Dependencies                                                                          │
│ 27 +         run: npm install                                                                                    │
│ 28 +                                                                                                             │
│ 29 +       - name: Prepare Android                                                                               │
│ 30 +         run: |                                                                                              │
│ 31 +           if [ ! -d "android" ]; then                                                                       │
│ 32 +             npx cap add android                                                                             │
│ 33 +           fi                                                                                                │
│ 34 +           npx cap sync                                                                                      │
│ 35 +                                                                                                             │
│ 36 +       - name: Build APK                                                                                     │
│ 37 +         run: |                                                                                              │
│ 38 +           cd android                                                                                        │
│ 39 +           sed -i 's/\r$//' gradlew                                                                          │
│ 40 +           chmod +x gradlew                                                                                  │
│ 41 +           ./gradlew assembleDebug                                                                           │
│ 42 +                                                                                                             │
│ 43 +       - name: Upload APK                                                                                    │
│ 44 +         uses: actions/upload-artifact@v4                                                                    │
│ 45 +         with:                                                                                               │
│ 46 +           name: sudoku-app                                                                                  │
│ 47 +           path: android/app/build/outputs/apk/debug/app-debug.apk